# Kagenti minimal installation configuration for OpenShift
# Auth is enabled in this config
#
# ⚠️  IMPORTANT VERSION REQUIREMENTS ⚠️
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# SPIRE/ZTWIM (Zero Trust Workload Identity Manager) requires OpenShift 4.19+
#
# If your cluster is running OCP < 4.19:
#   - Set components.spire.enabled to 'false' in kagenti-deps section (line 36)
#   - The Ansible installer will auto-detect and disable SPIRE on older versions
#   - See docs/ocp/openshift-install.md for upgrade instructions
#
# To check your OpenShift version:
#   oc version
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

####################################################################
# Toolhive - MCP server operator (must be at root level for Ansible installer)
####################################################################
toolhiveCRDs:
  enabled: true
  version: "0.0.83"

toolhiveOperator:
  enabled: true
  version: "0.5.12"
  release_name: toolhive-operator
  namespace: toolhive-system

charts:
  ####################################################################
  # kagenti-deps
  ####################################################################
  kagenti-deps:
    enabled: true
    values:
      openshift: true
      components:
        mcpInspector:
          enabled: true
        istio:
          enabled: true
        kiali:
          enabled: true
        keycloak:
          enabled: true
        otel:
          enabled: true
        spire:
          # ⚠️  REQUIRES OpenShift 4.19 or higher
          # The ZTWIM (Zero Trust Workload Identity Manager) operator is only available on OCP 4.19+
          # For OCP < 4.19: Set this to 'false' or the Ansible installer will auto-disable it
          enabled: true  # Use ZTWIM operator for OCP 4.19+
        tekton:
          enabled: true
        shipwright:
          enabled: true
          # Skip Helm hook for OpenShiftBuild operand - Ansible creates it after CRD is ready
          # This is needed on HyperShift/fresh installs where the CRD doesn't exist yet
          skipOpenShiftBuildOperand: true
        toolhiveCRDs:
          enabled: true
        toolhiveOperator:
          enabled: true
        certManager:
          enabled: true
        gatewayApi:
          enabled: false
        toolhive:
          enabled: true

  ####################################################################
  # kagenti
  ####################################################################
  kagenti:
    enabled: true
    values:
      openshift: true
      components:
        agentNamespaces:
          enabled: true
        platformOperator:
          enabled: true
        # Disable platformWebhook - it injects SPIFFE sidecars into MCPServers
        # but Tools don't need SPIFFE (they use delegated tokens from Agents)
        # and the SPIFFE CSI driver isn't available on OpenShift (ZTWIM uses different approach)
        platformWebhook:
          enabled: false
        ui:
          enabled: true
        # additional artifacts required by MCP gateway
        mcpGateway:
          enabled: true
        istio:
          enabled: false
      # configs
      ui:
        auth:
          enabled: true
      uiOAuthSecret:
        # for a OCP with self-signed certs for routes it should be true.
        # for a OCP with CA-signed certs for routes it should be false.
        useServiceAccountCA: true
      keycloak:
        url: http://keycloak-service.keycloak:8080
      # List of agent namespaces for Ansible installer to create internal-registry-secret
      agentNamespaces:
        - team1
        - team2

  ####################################################################
  # mcp-gateway chart
  ####################################################################
  mcpGateway:
    enabled: true

  ####################################################################
  # spire - On OpenShift, ZTWIM operator is used (configured in kagenti-deps)
  # Helm-based SPIRE is automatically skipped on OpenShift
  ####################################################################
  spire:
    enabled: false  # Helm SPIRE disabled; ZTWIM operator used via kagenti-deps
