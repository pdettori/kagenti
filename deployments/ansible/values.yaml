# Example values file for the Ansible installer.
# Use this single file to enable/disable components and provide per-chart values.
# Adjust chart paths to point at local charts or helm charts available to the cluster.

components:
  # Example component: kagenti main chart
  kagenti:
    enabled: true
    # chart: path to a local chart or chart reference (e.g. repo/chartname)
    chart: "../../charts/kagenti"
    release_name: "kagenti"
    namespace: "kagenti-system"
    # values that will be passed to the helm chart. This can be any valid
    # nested dict matching the chart's values.yaml keys.
    values:
      image:
        tag: "latest"
      service:
        type: "ClusterIP"

  # Example component: gateway-api or other chart in repo
  gateway-api:
    enabled: true
    # chart: "../../charts/gateway-api"
    # release_name: "gateway-api"
    # namespace: "kagenti-system"
    # values: {}

  # Infrastructure and dependency components mirrored from installer.sh
  kagenti-deps:
    enabled: true
    chart: "../../charts/kagenti-deps"
    release_name: "kagenti-deps"
    namespace: "kagenti-system"
    # Many flags in the original script are passed via --set to this chart.
    values:
      openshift: false
      components:
        istio:
          enabled: true
        kiali:
          enabled: true
        keycloak:
          enabled: true
        otel:
          enabled: true
        spire:
          enabled: true
        mcpInspector:
          enabled: true
        metricsServer:
          enabled: true
        containerRegistry:
          enabled: true
        tekton:
          enabled: true
        certManager:
          enabled: true
        gatewayApi:
          enabled: true
        ingressGateway:
          enabled: true
        toolhive:
          enabled: true

  istio:
    enabled: true
    # we will install Istio using the upstream charts (repo added during tasks)
    chart: "istio/base"
    release_name: "istio-base"
    namespace: "istio-system"
    values: {}

  cert-manager:
    enabled: true
    chart: "https://github.com/cert-manager/cert-manager/releases/download/v1.17.2/cert-manager.yaml"
    release_name: "cert-manager"
    namespace: "cert-manager"
    values: {}

  spire:
    enabled: true
    chart: "spire"
    release_name: "spire"
    namespace: "spire-mgmt"
    repo_url: "https://spiffe.github.io/helm-charts-hardened/"
    # Inline spire chart values copied from deployments/scripts/spire-helm-values.yaml
    # These values will be passed directly to the helm task from this file
    values:
      global:
        openshift: false
        spire:
          recommendations:
            enabled: true
          namespaces:
            create: true
          ingressControllerType: ""
          clusterName: agent-platform
          trustDomain: localtest.me
          caSubject:
            country: US
            organization: AgenticPlatformDemo
            commonName: localtest.me

      spire-server:
        tornjak:
          enabled: true
        controllerManager:
          ignoreNamespaces:
            - kube-system
            - kube-public
            - kagenti-system
            - tekton-*
            - istio-*
          identities:
            clusterSPIFFEIDs:
              default:
                autoPopulateDNSNames: true

      spiffe-oidc-discovery-provider:
        enabled: true
        tls:
          spire:
            enabled: false

      tornjak-frontend:
        enabled: true
        image:
          tag: v2.0.0
        ingress:
          enabled: true
        apiServerURL: http://spire-tornjak-api.localtest.me:8080
        service:
          type: ClusterIP
          port: 3000
        resources:
          requests:
            cpu: 50m
            memory: 128Mi
          limits:
            cpu: 100m
            memory: 512Mi

# Cluster management options (kind)
create_kind_cluster: true
kind_cluster_name: kagenti
kind_container_registry_enabled: true
kind_images_preload: true

# Paths to configs in the deployments/scripts directory (relative to playbook_dir)
kind_config: "../scripts/kind-config.yaml"
kind_config_registry: "../scripts/kind-config-registry.yaml"
preload_images_file: "../scripts/preload-images.txt"


# Optionally provide a list of extra helm value files to pass to all releases
# or leave empty. Paths are relative to the playbook directory unless absolute.
global_value_files: []

# Secrets handling: either provide secrets via environment variables (see README)
# or set secret_values_file when running the playbook (e.g. -e "secret_values_file=secret_values.yaml").
# If secret_values_file is used, values in that file will be merged into each
# component's values (top-level keys are merged).

secrets:
  # if provided, this filename will be loaded by the role (example: secret_values.yaml)
  file: "secret_values.yaml"
